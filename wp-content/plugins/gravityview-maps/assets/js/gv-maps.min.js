window.GV_MAPS=window.GV_MAPS||{},function($){"use strict";var self=$.extend({did_scroll:!1,map_offset:0,map_sticky_container:null,map_entries_container_selector:".gv-map-entries",markers:[],maps:[],is_single_entry:!1,infowindow:{no_empty:!0,max_width:300},mobile_breakpoint:600},window.GV_MAPS),bounds=new google.maps.LatLngBounds,infowindow=new google.maps.InfoWindow({content:"",maxWidth:parseInt(self.infowindow.max_width,10)});self.init=function(){var first_map=document.getElementById(self.map_id_prefix+"-0");null!==first_map&&($(".gv-map-single-container").length>0&&(self.is_single_entry=!0),self.multiple_maps=parseInt(self.multiple_maps,10),self.sticky_canvas_prepare(),self.setup_map_options(),self.setup_maps(),self.markers_process(),self.mobile_init(),self.start_scroll_check(),self.markers_animate_init())},self.setup_map_options=function(){self.MapOptions.zoom=parseInt(self.MapOptions.zoom,10),self.MapOptions.mapTypeId=google.maps.MapTypeId[self.MapOptions.mapTypeId],self.MapOptions.hasOwnProperty("zoomControl")&&!0===self.MapOptions.zoomControl&&self.MapOptions.zoomControlOptions&&self.MapOptions.zoomControlOptions.hasOwnProperty("position")&&(self.MapOptions.zoomControlOptions={position:google.maps.ControlPosition[self.MapOptions.zoomControlOptions.position]})},self.setup_maps=function(){for(var m,map_element,i=0;i<=self.multiple_maps;i++)if(map_element=document.getElementById(self.map_id_prefix+"-"+i.toString()),null!==map_element){var trafficLayer=new google.maps.TrafficLayer,transitLayer=new google.maps.TransitLayer,bicyclingLayer=new google.maps.BicyclingLayer;m=new google.maps.Map(map_element,self.MapOptions),1===self.layers.bicycling&&bicyclingLayer.setMap(m),1===self.layers.transit&&transitLayer.setMap(m),1===self.layers.traffic&&trafficLayer.setMap(m),self.maps.push(m),self.set_zoom(m)}else console&&console.error("GravityView map DOM element not found at #"+self.map_id_prefix+"-"+i.toString()+"; map not created.")},self.set_zoom=function(map){google.maps.event.addListenerOnce(map,"idle",function(){map.getZoom()>self.MapOptions.zoom&&map.setZoom(self.MapOptions.zoom)})},self.markers_process=function(){for(var i in self.markers_info)self.markers_info.hasOwnProperty(i)&&self.maps.forEach(self.marker_add,self.markers_info[i])},self.marker_add=function(map,i,array){var entryID=document.getElementById(self.map_id_prefix+"-"+i.toString()).getAttribute("data-entryid");if(!entryID||entryID==this.entry_id){var geo=new google.maps.LatLng(this.lat,this.long),icon=this.icon_url||self.icon,marker=new google.maps.Marker({map:map,icon:icon,url:this.url,position:geo,entryId:this.entry_id,content:this.content});entryID?self.maps[i].fitBounds((new google.maps.LatLngBounds).extend(marker.position)):(bounds.extend(marker.position),self.maps[i].fitBounds(bounds)),self.marker_add_events(marker,map),self.markers.push(marker)}},self.marker_add_events=function(marker,map){self.is_single_entry||(google.maps.event.addListener(marker,"click",self.marker_on_click(marker)),google.maps.event.addListener(marker,"mouseover",self.marker_on_over(marker)),google.maps.event.addListener(marker,"mouseout",self.marker_on_mouseout(marker)),google.maps.event.addListener(map,"click",function(){infowindow.close()}))},self.marker_on_click=function(marker){return function(){var content=self.infowindow_get_content(marker.content);content?(infowindow.setContent(content),infowindow.open(marker.map,marker)):(infowindow.close(),window.open(marker.url,self.marker_link_target))}},self.infowindow_get_content=function(content){if(!self.infowindow.no_empty)return content;var $content=$(content);return $content.find('img[src=""]').remove().end().addClass(function(){if(0===$content.find("img").length)return"gv-infowindow-no-image"}).find("a.gv-infowindow-entry-link:not([allow-empty]):empty").text(self.infowindow.empty_text),$content.prop("outerHTML")},self.marker_on_over=function(marker){return function(){$("#gv_map_"+marker.entryId).addClass("gv-highlight-entry")}},self.marker_on_mouseout=function(marker){return function(){$("#gv_map_"+marker.entryId).removeClass("gv-highlight-entry")}},self.markers_animate_init=function(){self.is_single_entry||""===self.icon_bounce||$(".gv-map-view").on("mouseenter",self.marker_animate)},self.marker_animate=function(e){var id=this.id.replace("gv_map_","");self.markers.forEach(self.marker_animation_start,id)},self.marker_animation_start=function(marker,i,array){if(marker.entryId===this){if(marker.animating)return;marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(self.marker_animation_stop,750,marker)}},self.marker_animation_stop=function(marker,i){marker.setAnimation(null)},self.sticky_canvas_prepare=function(){self.map_sticky_container=$(".gv-map-sticky-container");var windowHeight=$(window).height(),doubleCanvasHeight=2*self.map_sticky_container.height();windowHeight<doubleCanvasHeight&&$(".gv-map-canvas").height(windowHeight/2)},self.window_scroll_init_offset=function(){self.map_offset=self.map_sticky_container.offset().top},self.scroll_set=function(){self.did_scroll=!0},self.start_scroll_check=function(){self.map_sticky_container.length>0&&($(window).one("scroll",self.window_scroll_init_offset),setInterval(self.window_on_scroll,250))},self.window_on_scroll=function(){if(self.did_scroll){self.did_scroll=!1;var scroll=$(window).scrollTop(),canvasObj=self.map_sticky_container.find("."+self.map_id_prefix),listObj=$(self.map_entries_container_selector),canvasWidth=canvasObj.width(),canvasHeight=canvasObj.height();scroll>=self.map_offset?(canvasObj.width(canvasWidth),self.map_sticky_container.addClass("gv-sticky"),"top"===self.template_layout&&listObj.css("margin-top",canvasHeight+"px")):(canvasObj.width("100%"),self.map_sticky_container.removeClass("gv-sticky"),"top"===self.template_layout&&listObj.css("margin-top",""))}},self.mobile_init=function(){self.map_sticky_container.length<=0||$(window).width()<=parseInt(self.mobile_breakpoint,10)&&self.mobile_map_to_top()},self.mobile_map_to_top=function(){var parent=self.map_sticky_container.parent(),grandpa=$(".gv-map-container");parent.hasClass("gv-grid-col-1-3")&&1===parent.index()&&parent.detach().prependTo(grandpa)},$(self.init),$(window).scroll(self.scroll_set),window.GV_MAPS=self}(jQuery);